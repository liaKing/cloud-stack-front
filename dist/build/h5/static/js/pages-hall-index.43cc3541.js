(self["webpackChunkcloud_stock"]=self["webpackChunkcloud_stock"]||[]).push([[123],{146:function(t,e,i){"use strict";i.d(e,{FF:function(){return o},SR:function(){return r},t7:function(){return n}});var a=i(132);const o=(t={})=>(0,a.A)({url:"/stock/item/list",method:"GET",params:t}),n=t=>(0,a.A)({url:"/stock/buy",method:"PUT",data:t}),r=()=>(0,a.A)({url:"/stock/user",method:"GET"})},189:function(t,e,i){var a=i(681);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.id,a,""]]),a.locals&&(t.exports=a.locals);var o=i(583).A;o("2cc5c838",a,!0,{sourceMap:!1,shadowMode:!1})},681:function(t,e,i){"use strict";i.r(e);var a=i(935),o=i.n(a),n=i(56),r=i.n(n),s=r()(o());s.push([t.id,".container[data-v-280f16f4]{padding:0;background-color:#f5f7fa;min-height:100vh;padding-bottom:80px}.tab-wrapper[data-v-280f16f4]{padding:10px 16px;background-color:#fff;box-shadow:0 2px 8px rgba(0,0,0,.03)}.order-list[data-v-280f16f4]{padding:16px}.order-list .order-card[data-v-280f16f4]{background-color:#fff;border-radius:12px;padding:16px;margin-bottom:12px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,.02)}.order-list .order-card .card-left[data-v-280f16f4]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.order-list .order-card .card-left .item-name[data-v-280f16f4]{font-size:16px;font-weight:700;color:#303133;margin-bottom:6px}.order-list .order-card .card-left .user-info[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;gap:4px}.order-list .order-card .card-left .user-info .username[data-v-280f16f4]{font-size:12px;color:#909399}.order-list .order-card .card-center[data-v-280f16f4]{text-align:center;margin:0 16px}.order-list .order-card .card-center .price-box[data-v-280f16f4]{color:#2979ff;font-weight:700}.order-list .order-card .card-center .price-box .currency[data-v-280f16f4]{font-size:12px;margin-right:2px}.order-list .order-card .card-center .price-box .price[data-v-280f16f4]{font-size:18px}.order-list .order-card .card-center .qty[data-v-280f16f4]{font-size:12px;color:#909399;margin-top:2px}.order-list .order-card .card-right[data-v-280f16f4]{min-width:70px}.fab-container[data-v-280f16f4]{position:fixed;bottom:30px;right:20px;width:56px;height:56px;background:-webkit-linear-gradient(315deg,#2979ff,#609cff);background:linear-gradient(135deg,#2979ff,#609cff);border-radius:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;box-shadow:0 6px 16px rgba(41,121,255,.4);z-index:100;-webkit-transition:-webkit-transform .2s;transition:-webkit-transform .2s;transition:transform .2s;transition:transform .2s,-webkit-transform .2s}.fab-container[data-v-280f16f4]:active{-webkit-transform:scale(.95);transform:scale(.95)}.popup-content[data-v-280f16f4]{padding:20px;background-color:#fff}.popup-content .popup-header[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin-bottom:24px}.popup-content .popup-header .title[data-v-280f16f4]{font-size:18px;font-weight:700;color:#303133}.popup-content .type-selector[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;gap:16px;margin-bottom:24px}.popup-content .type-selector .type-item[data-v-280f16f4]{-webkit-box-flex:1;-webkit-flex:1;flex:1;background-color:#f5f7fa;padding:12px;border-radius:8px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;gap:8px;font-weight:500;color:#606266;border:1px solid transparent;-webkit-transition:all .2s;transition:all .2s}.popup-content .type-selector .type-item.active[data-v-280f16f4]{background-color:#ecf5ff;color:#2979ff}.popup-content .type-selector .type-item.active.sell[data-v-280f16f4]{background-color:#fef0f0;color:#f56c6c;border-color:#fde2e2}.popup-content .type-selector .type-item.active.buy[data-v-280f16f4]{background-color:#f0f9eb;color:#19be6b;border-color:#e1f3d8}.popup-content .input-row[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;gap:16px}.popup-content .input-row .half-width[data-v-280f16f4]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.popup-content .btn-group[data-v-280f16f4]{margin-top:30px}.modal-content[data-v-280f16f4]{padding:10px 0}.modal-content .trade-summary[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;background-color:#f9fafe;padding:16px;border-radius:8px;margin-bottom:20px}.modal-content .trade-summary .summary-item[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.modal-content .trade-summary .summary-item .label[data-v-280f16f4]{font-size:12px;color:#909399;margin-bottom:6px}.modal-content .trade-summary .summary-item .value[data-v-280f16f4]{font-size:18px;font-weight:700;color:#303133}.modal-content .trade-summary .summary-item .value.highlight[data-v-280f16f4]{color:#2979ff}.modal-content .input-area[data-v-280f16f4]{margin-bottom:20px}.modal-content .input-area .input-suffix[data-v-280f16f4]{font-size:14px;color:#909399;padding-left:8px}.modal-content .total-calc[data-v-280f16f4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;padding-top:12px;border-top:1px solid #ebeef5}.modal-content .total-calc .label[data-v-280f16f4]{font-size:14px;color:#606266}.modal-content .total-calc .amount[data-v-280f16f4]{font-size:18px;font-weight:700;color:#f56c6c}",""]),e["default"]=s},830:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return v}});var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"container"},[i("u-sticky",{attrs:{bgColor:"#f5f7fa"}},[i("v-uni-view",{staticClass:"tab-wrapper"},[i("u-subsection",{attrs:{list:t.tabList,current:t.currentTab,activeColor:"#2979ff",bgColor:"#ffffff",mode:"button"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.sectionChange.apply(void 0,arguments)}}})],1)],1),i("v-uni-view",{staticClass:"order-list"},[t._l(t.orderList,function(e,a){return i("v-uni-view",{key:a,staticClass:"order-card"},[i("v-uni-view",{staticClass:"card-left"},[i("v-uni-view",{staticClass:"item-name"},[t._v(t._s(t.getItemName(e.itemId)))]),i("v-uni-view",{staticClass:"user-info"},[i("u-icon",{attrs:{name:"account",size:"14",color:"#909399"}}),i("v-uni-text",{staticClass:"username"},[t._v("用户 "+t._s((e.initiatorId||"").toString().slice(-6)||"-"))])],1)],1),i("v-uni-view",{staticClass:"card-center"},[i("v-uni-view",{staticClass:"price-box"},[i("v-uni-text",{staticClass:"currency"},[t._v("¥")]),i("v-uni-text",{staticClass:"price"},[t._v(t._s(e.price))])],1),i("v-uni-view",{staticClass:"qty"},[t._v("可交易: "+t._s(void 0!==e.remaining?e.remaining:e.quantity))])],1),i("v-uni-view",{staticClass:"card-right"},[i("u-button",{attrs:{type:0===t.currentTab?"success":"warning",text:0===t.currentTab?"购买":"出售",size:"small",shape:"circle",customStyle:"height: 32px; padding: 0 16px; font-weight: bold;"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.openAcceptModal(e)}}})],1)],1)}),0===t.orderList.length?i("u-empty",{attrs:{mode:"list",icon:"http://cdn.uviewui.com/uview/empty/list.png",text:"暂无交易挂单"}}):t._e()],2),i("v-uni-view",{staticClass:"fab-container",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showPostModal=!0}}},[i("u-icon",{attrs:{name:"plus",color:"#fff",size:"28"}})],1),i("u-modal",{attrs:{show:t.showAcceptModal,title:0===t.currentTab?"购买股票":"出售股票",showCancelButton:!0,confirmColor:"#2979ff"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.handleAccept.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=t.$handleEvent(e),t.showAcceptModal=!1}}},[i("v-uni-view",{staticClass:"modal-content"},[i("v-uni-view",{staticClass:"trade-summary"},[i("v-uni-view",{staticClass:"summary-item"},[i("v-uni-text",{staticClass:"label"},[t._v("交易单价")]),i("v-uni-text",{staticClass:"value highlight"},[t._v(t._s(t.currentOrder.price))])],1),i("v-uni-view",{staticClass:"summary-item"},[i("v-uni-text",{staticClass:"label"},[t._v("可交易量")]),i("v-uni-text",{staticClass:"value"},[t._v(t._s(void 0!==t.currentOrder.remaining?t.currentOrder.remaining:t.currentOrder.quantity))])],1)],1),i("v-uni-view",{staticClass:"input-area"},[i("u-input",{attrs:{placeholder:"请输入交易数量",type:"number",border:"surround",shape:"circle"},model:{value:t.acceptQuantity,callback:function(e){t.acceptQuantity=e},expression:"acceptQuantity"}},[i("template",{slot:"suffix"},[i("v-uni-text",{staticClass:"input-suffix"},[t._v("股")])],1)],2)],1),t.acceptQuantity?i("v-uni-view",{staticClass:"total-calc"},[i("v-uni-text",{staticClass:"label"},[t._v(t._s(0===t.currentTab?"预计支付":"预计收益"))]),i("v-uni-text",{staticClass:"amount"},[t._v(t._s(t.acceptQuantity*t.currentOrder.price)+" 幸运值")])],1):t._e()],1)],1),i("u-popup",{attrs:{show:t.showPostModal,mode:"bottom",round:16},on:{close:function(e){arguments[0]=e=t.$handleEvent(e),t.showPostModal=!1}}},[i("v-uni-view",{staticClass:"popup-content"},[i("v-uni-view",{staticClass:"popup-header"},[i("v-uni-text",{staticClass:"title"},[t._v("发布挂单")]),i("u-icon",{attrs:{name:"close",size:"20",color:"#909399"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showPostModal=!1}}})],1),i("v-uni-view",{staticClass:"form-body"},[i("v-uni-view",{staticClass:"type-selector"},[i("v-uni-view",{staticClass:"type-item",class:{active:1===t.postForm.type,sell:1===t.postForm.type},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.postForm.type=1}}},[i("v-uni-text",[t._v("我要卖出")]),1===t.postForm.type?i("u-icon",{attrs:{name:"checkmark-circle-fill",color:"#f56c6c",size:"18"}}):t._e()],1),i("v-uni-view",{staticClass:"type-item",class:{active:2===t.postForm.type,buy:2===t.postForm.type},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.postForm.type=2}}},[i("v-uni-text",[t._v("我要求购")]),2===t.postForm.type?i("u-icon",{attrs:{name:"checkmark-circle-fill",color:"#19be6b",size:"18"}}):t._e()],1)],1),i("u-form",{ref:"postForm",attrs:{labelPosition:"top",model:t.postForm}},[i("u-form-item",{attrs:{label:"选择项目",borderBottom:!0},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showItemSelect=!0}}},[i("u-input",{attrs:{disabled:!0,disabledColor:"#ffffff",placeholder:"点击选择项目",border:"none"},model:{value:t.postForm.itemName,callback:function(e){t.$set(t.postForm,"itemName",e)},expression:"postForm.itemName"}}),i("u-icon",{attrs:{slot:"right",name:"arrow-right",color:"#c0c4cc"},slot:"right"})],1),i("v-uni-view",{staticClass:"input-row"},[i("u-form-item",{staticClass:"half-width",attrs:{label:"单价 (幸运值)",prop:"price"}},[i("u-input",{attrs:{type:"number",placeholder:"0.00",border:"surround"},model:{value:t.postForm.price,callback:function(e){t.$set(t.postForm,"price",e)},expression:"postForm.price"}})],1),i("u-form-item",{staticClass:"half-width",attrs:{label:"数量 (股)",prop:"quantity"}},[i("u-input",{attrs:{type:"number",placeholder:"0",border:"surround"},model:{value:t.postForm.quantity,callback:function(e){t.$set(t.postForm,"quantity",e)},expression:"postForm.quantity"}})],1)],1)],1),i("v-uni-view",{staticClass:"btn-group"},[i("u-button",{attrs:{type:"primary",text:"确认发布",shape:"circle",customStyle:"height: 44px; font-size: 16px;"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handlePost.apply(void 0,arguments)}}})],1)],1)],1)],1),i("u-picker",{attrs:{show:t.showItemSelect,columns:[t.itemListNames]},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.itemSelectConfirm.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=t.$handleEvent(e),t.showItemSelect=!1}}})],1)},o=[],n={},r=i(132);const s=(t={})=>(0,r.A)({url:"/trade/orders",method:"GET",params:t}),c=t=>(0,r.A)({url:"/trade/buy",method:"PUT",data:t}),l=t=>(0,r.A)({url:"/trade/sell",method:"PUT",data:t}),d=t=>(0,r.A)({url:"/trade/accept",method:"PUT",data:t});var p,f=i(146),u={data(){return{tabList:[{name:"出售大厅"},{name:"求购大厅"}],currentTab:0,orderList:[],itemList:[],showAcceptModal:!1,currentOrder:{},acceptQuantity:"",showPostModal:!1,postForm:{type:1,itemId:"",itemName:"",price:"",quantity:""},showItemSelect:!1}},computed:{itemListNames(){return this.itemList.map(t=>t.name)}},onShow(){this.fetchItems(),this.fetchOrders()},onPullDownRefresh(){this.fetchOrders().finally(()=>{uni.stopPullDownRefresh()})},methods:{sectionChange(t){this.currentTab=t,this.fetchOrders()},async fetchItems(){try{const t=await(0,f.FF)();0===t.code&&t.data&&(this.itemList=t.data.list||[])}catch(t){}},getItemName(t){const e=this.itemList.find(e=>e.id===t);return e?e.name:t},async fetchOrders(){try{const t=0===this.currentTab?1:2,e=await s({orderType:t});0===e.code&&e.data&&(this.orderList=e.data.list||[])}catch(t){}},openAcceptModal(t){this.currentOrder=t,this.acceptQuantity="",this.showAcceptModal=!0},async handleAccept(){if(!this.acceptQuantity||this.acceptQuantity<=0)uni.showToast({title:"请输入有效数量",icon:"none"});else try{const t=await d({orderId:this.currentOrder.id,quantity:Number(this.acceptQuantity)});0===t.code?(uni.showToast({title:"交易成功",icon:"success"}),this.showAcceptModal=!1,this.fetchOrders(),this.$store.dispatch("updateUserInfo")):uni.showToast({title:t.message||t.msg||"交易失败",icon:"none"})}catch(t){console.error(t)}},itemSelectConfirm(t){const e=t.indexs[0],i=this.itemList[e];this.postForm.itemId=i.id,this.postForm.itemName=i.name,this.showItemSelect=!1},async handlePost(){if(!this.postForm.itemId||!this.postForm.price||!this.postForm.quantity)return void uni.showToast({title:"请填写完整",icon:"none"});const t={itemId:this.postForm.itemId,price:Number(this.postForm.price),quantity:Number(this.postForm.quantity)};try{let e;e=1===this.postForm.type?await l(t):await c(t),0===e.code?(uni.showToast({title:"发布成功",icon:"success"}),this.showPostModal=!1,this.postForm={type:1,itemId:"",itemName:"",price:"",quantity:""},this.fetchOrders()):uni.showToast({title:e.message||e.msg||"发布失败",icon:"none"})}catch(e){console.error(e)}}}},m=u,b=(i(189),i(535)),h=(0,b.A)(m,a,o,!1,null,"280f16f4",null,!1,n,p),v=h.exports}}]);