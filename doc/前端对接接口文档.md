# 投壶股票系统 - 前端对接接口文档

> 供前端开发使用的后端接口说明，包含接口路径、请求参数与响应格式。  
> **基础路径**：`http://{host}:8889`（按实际部署替换 host）。  
> **约定**：ID 与前端统一使用 `string`，时间统一使用时间戳（BIGINT）。

---

## 一、通用说明

### 1.1 响应格式

所有接口 HTTP 状态码为 `200` 时，响应体统一为：

```json
{
  "code": 0,
  "data": {}
}
```

- **code**：业务码，`0` 表示成功，非 0 表示失败（见错误码表）。
- **data**：成功时为业务数据；失败时多为 `{}` 或错误说明。

### 1.2 鉴权方式

- **需登录接口**：请求头需携带  
  `Authorization: Bearer {access_token}`  
  登录成功后从 `/user/login` 响应的 `data.access_token` 获取。
- **管理员接口**：在登录鉴权基础上，要求当前用户为管理员（后端按 `userId` 判断）。

### 1.3 错误码表

| code | 说明 |
|------|------|
| 0 | 成功 |
| 101 | 幸运值不足 |
| 102 | 账号重复 |
| 103 | 密码不正确 |
| 104 | session 生成失败 |
| 105 | 用户不存在 |
| 106 | 用户已注销 |
| 107 | 未登录 |
| 108 | token 生成失败 / 用户信息错误 |
| 203 | 用户持仓不存在 |
| 205 | 持仓不足 |
| 301 | 挂单不存在 |
| 302 | 挂单已完全成交 |
| 303 | 挂单已撤销 |
| 304 | 挂单剩余数量不足 |
| 305 | 订单类型错误 |
| 306 | 不能应自己的单 |
| 307 | 只能撤销自己的挂单 |
| 401 | 项目不存在 |
| 402 | 项目已废除 |
| 403 | 项目状态不允许此操作 |
| 901 | 数据库错误 |
| 902 | 参数错误 |
| 其它 | 参数解析失败 / 关键信息丢失等，见接口说明 |

---

## 二、用户模块 `/user`

### 2.1 登录

| 项目 | 说明 |
|------|------|
| **接口** | 登录 |
| **方法** | POST |
| **路径** | `/user/login` |
| **鉴权** | 否 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userName | string | 是 | 用户名 |
| passWord | string | 是 | 密码 |

**请求示例**

```json
{
  "userName": "zhangsan",
  "passWord": "123456"
}
```

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| access_token | string | 访问令牌，用于 Authorization |
| refresh_token | string | 刷新令牌 |

```json
{
  "code": 0,
  "data": {
    "access_token": "eyJhbGc...",
    "refresh_token": "eyJhbGc..."
  }
}
```

---

### 2.2 获取用户信息

| 项目 | 说明 |
|------|------|
| **接口** | 获取当前用户信息 |
| **方法** | POST |
| **路径** | `/user/get` |
| **鉴权** | 是（按实现可能支持不鉴权时查某用户） |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userId | string | 是 | 用户 ID |

**成功响应 data**：用户对象 User

| 字段 | 类型 | 说明 |
|------|------|------|
| userId | string | 用户 ID |
| userName | string | 用户名 |
| realName | string | 真实姓名 |
| name | string | 昵称 |
| weChat | string | 微信号 |
| phoneNumber | string | 手机号 |
| address | string | 地址 |
| luck | number | 幸运值 |
| referrer | string | 推荐人 |
| ctime | number | 注册时间戳 |
| delFlg | number | 删除标记 |
| deletionReason | string | 删除理由 |

---

### 2.3 管理员 - 注册用户

| 项目 | 说明 |
|------|------|
| **接口** | 管理员注册用户 |
| **方法** | POST |
| **路径** | `/user/admin/register` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userName | string | 是 | 用户名 |
| passWord | string | 是 | 密码 |
| realName | string | 是 | 真实姓名 |
| name | string | 否 | 昵称 |
| weChat | string | 否 | 微信号 |
| phoneNumber | string | 否 | 手机号 |
| address | string | 否 | 地址 |
| referrer | string | 否 | 推荐人 |

**成功响应**：`data` 为空对象 `{}`。

---

### 2.4 管理员 - 删除用户

| 项目 | 说明 |
|------|------|
| **接口** | 管理员删除用户 |
| **方法** | POST |
| **路径** | `/user/admin/del` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userId | string | 是 | 用户 ID |
| deletionReason | string | 否 | 删除理由 |

**成功响应**：`data` 为空对象 `{}`。

---

### 2.5 管理员 - 增减幸运值

| 项目 | 说明 |
|------|------|
| **接口** | 管理员增减用户幸运值（正数增加，负数减少） |
| **方法** | POST |
| **路径** | `/user/admin/doluck` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userId | string | 是 | 用户 ID |
| luck | number | 是 | 变化量，正数增加、负数减少 |

**成功响应 data**：更新后的用户对象 User（结构同 2.2）。

---

## 三、项目与官方出售 `/stock`

以下接口均需**登录**，请求头带 `Authorization: Bearer {access_token}`。

### 3.1 从官方购买项目股票

| 项目 | 说明 |
|------|------|
| **接口** | 从官方购买项目股票（仅项目状态为「立项中」时可购买） |
| **方法** | PUT |
| **路径** | `/stock/buy` |
| **鉴权** | 登录 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 是 | 项目 ID |
| quantity | number | 是 | 购买数量（股） |

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| itemId | string | 项目 ID |
| quantity | number | 购买数量 |

---

### 3.2 获取项目列表

| 项目 | 说明 |
|------|------|
| **接口** | 获取项目列表（分页） |
| **方法** | GET |
| **路径** | `/stock/list` |
| **鉴权** | 登录 |

**Query 参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | number | 否 | 页码，默认 1 |
| pageSize | number | 否 | 每页条数，默认 20 |
| status | number | 否 | 状态筛选：1=立项中 2=已淘汰 3=游戏中 4=已结算 |

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| list | Item[] | 项目列表 |
| total | number | 总条数 |
| pageNum | number | 当前页 |
| pageSize | number | 每页条数 |

**Item 对象**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | string | 项目 ID |
| name | string | 项目名称 |
| description | string | 描述 |
| purchasePrice | number | 进货价（幸运值） |
| totalValue | number | 当前总价值 |
| totalQuantity | number | 当前总股数 |
| status | number | 1=立项中 2=已淘汰 3=游戏中 4=已结算 |
| ctime | number | 创建时间戳 |
| mtime | number | 修改时间戳 |

---

### 3.3 获取当前用户持仓列表

| 项目 | 说明 |
|------|------|
| **接口** | 获取当前登录用户持仓列表（按项目维度） |
| **方法** | GET |
| **路径** | `/stock/user` |
| **鉴权** | 登录 |

**请求体**：无。

**成功响应 data**：StockUser[] 数组

| 字段 | 类型 | 说明 |
|------|------|------|
| stockUserId | string | 持仓记录 ID |
| stockId | string | 项目 ID（与 item.id 对应） |
| stockName | string | 项目名称 |
| stockNumber | number | 持有股数 |
| userId | string | 用户 ID |

---

## 四、交易大厅 `/trade`

以下接口均需**登录**。

### 4.1 挂卖单

| 项目 | 说明 |
|------|------|
| **接口** | 挂卖单 |
| **方法** | PUT |
| **路径** | `/trade/sell` |
| **鉴权** | 登录 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 是 | 项目 ID |
| price | number | 是 | 单价（幸运值） |
| quantity | number | 是 | 数量 |

**成功响应 data**：挂单对象 Order（见 4.4）。

---

### 4.2 挂买单

| 项目 | 说明 |
|------|------|
| **接口** | 挂买单（会预扣幸运值） |
| **方法** | PUT |
| **路径** | `/trade/buy` |
| **鉴权** | 登录 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 是 | 项目 ID |
| price | number | 是 | 单价（幸运值） |
| quantity | number | 是 | 数量 |

**成功响应 data**：挂单对象 Order（见 4.4）。

---

### 4.3 挂单列表

| 项目 | 说明 |
|------|------|
| **接口** | 挂单列表（分页、筛选） |
| **方法** | GET |
| **路径** | `/trade/orders` |
| **鉴权** | 登录 |

**Query 参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 否 | 项目 ID |
| orderType | number | 否 | 1=卖单 2=买单 |
| priceMin | number | 否 | 最低单价 |
| priceMax | number | 否 | 最高单价 |
| pageNum | number | 否 | 页码，默认 1 |
| pageSize | number | 否 | 每页条数，默认 20 |

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| list | Order[] | 挂单列表 |
| total | number | 总条数 |
| pageNum | number | 当前页 |
| pageSize | number | 每页条数 |

---

### 4.4 应单

| 项目 | 说明 |
|------|------|
| **接口** | 应单（对卖单：当前用户为买家；对买单：当前用户为卖家） |
| **方法** | PUT |
| **路径** | `/trade/accept` |
| **鉴权** | 登录 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| orderId | string | 是 | 挂单 ID |
| quantity | number | 是 | 应单数量 |

**成功响应**：`data` 为空对象 `{}`。

---

### 4.5 撤销挂单

| 项目 | 说明 |
|------|------|
| **接口** | 撤销自己的挂单 |
| **方法** | PUT |
| **路径** | `/trade/cancel` |
| **鉴权** | 登录 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| orderId | string | 是 | 挂单 ID |

**成功响应**：`data` 为空对象 `{}`。

**Order 对象（挂单）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | string | 挂单 ID |
| orderType | number | 1=卖单 2=买单 |
| initiatorId | string | 发起人用户 ID |
| itemId | string | 项目 ID |
| price | number | 单价（幸运值） |
| quantity | number | 挂单数量 |
| remaining | number | 剩余未成交数量 |
| status | number | 1=挂单中 2=部分成交 3=完全成交 4=已撤销 |
| ctime | number | 创建时间戳 |
| mtime | number | 修改时间戳 |

---

### 4.6 我的成交记录

| 项目 | 说明 |
|------|------|
| **接口** | 我的成交记录（作为买家或卖家参与的） |
| **方法** | GET |
| **路径** | `/trade/records` |
| **鉴权** | 登录 |

**Query 参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | number | 否 | 页码，默认 1 |
| pageSize | number | 否 | 每页条数，默认 20 |

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| list | TradeRecord[] | 成交记录列表 |
| total | number | 总条数 |
| pageNum | number | 当前页 |
| pageSize | number | 每页条数 |

**TradeRecord 对象**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | string | 成交记录 ID |
| orderId | string | 关联挂单 ID |
| buyerId | string | 买家用户 ID |
| sellerId | string | 卖家用户 ID |
| itemId | string | 项目 ID |
| quantity | number | 成交数量 |
| price | number | 成交单价 |
| totalAmount | number | 总成交金额 |
| ctime | number | 成交时间戳 |

---

## 五、管理端 `/admin`

以下接口均需**登录且为管理员**。

### 5.1 批量创建/更新项目

| 项目 | 说明 |
|------|------|
| **接口** | 批量创建或更新项目 |
| **方法** | POST |
| **路径** | `/admin/item/batch` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| items | array | 是 | 项目列表，见下表 |

**items[] 元素**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | string | 更新时必填 | 项目 ID，不传则新建 |
| name | string | 是 | 项目名称 |
| description | string | 否 | 描述 |
| purchasePrice | number | 是 | 进货价（幸运值） |

**请求示例**

```json
{
  "items": [
    { "name": "物品A", "description": "描述", "purchasePrice": 10 },
    { "id": "123", "name": "物品B", "description": "描述", "purchasePrice": 10 }
  ]
}
```

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| created | Item[] | 本次新建的项目 |
| updated | Item[] | 本次更新的项目 |

---

### 5.2 废除项目

| 项目 | 说明 |
|------|------|
| **接口** | 废除项目（数量不足等场景），退还持仓用户幸运值并淘汰项目 |
| **方法** | POST |
| **路径** | `/admin/item/abolish` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 是 | 项目 ID |

**成功响应**：`data` 为空对象 `{}`。

---

### 5.3 提交投壶

| 项目 | 说明 |
|------|------|
| **接口** | 提交一次投壶，按规则更新各项目总价值 |
| **方法** | POST |
| **路径** | `/admin/throw/submit` |
| **鉴权** | 管理员 |

**请求体 (application/json)**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| playerPay | number | 是 | 玩家付费（幸运值） |
| totalItems | number | 是 | 总项目数 |
| hits | array | 是 | 命中列表，见下表 |

**hits[] 元素**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| itemId | string | 是 | 项目 ID |
| hitCount | number | 是 | 被投中次数 |

**请求示例**

```json
{
  "playerPay": 10,
  "totalItems": 10,
  "hits": [
    { "itemId": "项目A的ID", "hitCount": 1 },
    { "itemId": "项目B的ID", "hitCount": 2 }
  ]
}
```

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| throwRecordId | string | 投壶记录 ID |

---

### 5.4 每日结算

| 项目 | 说明 |
|------|------|
| **接口** | 触发当日结算（按项目逐个结算，退还用户幸运值等） |
| **方法** | POST |
| **路径** | `/admin/settlement/daily` |
| **鉴权** | 管理员 |

**请求体 (application/json)**：可为空或传日期

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| date | number | 否 | 结算日期时间戳，不传则用当前日期 |

**成功响应 data**

| 字段 | 类型 | 说明 |
|------|------|------|
| batchId | string | 结算批次 ID |
| date | number | 结算日期时间戳 |

---

## 六、接口汇总表

| 模块 | 方法 | 路径 | 鉴权 |
|------|------|------|------|
| 用户 | POST | /user/login | 否 |
| 用户 | POST | /user/get | 是 |
| 用户 | POST | /user/admin/register | 管理员 |
| 用户 | POST | /user/admin/del | 管理员 |
| 用户 | POST | /user/admin/doluck | 管理员 |
| 项目/官方出售 | PUT | /stock/buy | 登录 |
| 项目/官方出售 | GET | /stock/list | 登录 |
| 项目/官方出售 | GET | /stock/user | 登录 |
| 交易大厅 | PUT | /trade/sell | 登录 |
| 交易大厅 | PUT | /trade/buy | 登录 |
| 交易大厅 | GET | /trade/orders | 登录 |
| 交易大厅 | PUT | /trade/accept | 登录 |
| 交易大厅 | PUT | /trade/cancel | 登录 |
| 交易大厅 | GET | /trade/records | 登录 |
| 管理端-项目 | POST | /admin/item/batch | 管理员 |
| 管理端-项目 | POST | /admin/item/abolish | 管理员 |
| 管理端-投壶 | POST | /admin/throw/submit | 管理员 |
| 管理端-结算 | POST | /admin/settlement/daily | 管理员 |

---

## 七、调试说明

- 测试环境若开启 Debug，可在请求头中增加 `debug: 1`（或非空值），部分鉴权可跳过，具体以后端实现为准。
- 时间字段均为**时间戳**（秒级 BIGINT）。
- 所有 ID（userId、itemId、orderId 等）均为 **string** 类型（雪花算法生成）。

如有字段或错误码变更，以后端实际为准，本文档可与后端同学同步更新。
